---
title: Java架构学习笔记——20231026
date: 2023-10-26 15:02:08
categories: 
- 学习
tags:
- 程序架构
---

### 邓宁克鲁格效应

- 能力越差的人越容易高估自己
- 能力越差的人发现不了自己和别人的差距
- 人类有虚幻的优越感，总觉得自己比别人厉害

### 架构哲学

#### 系统架构的使命和责任
- 兼容过去问题：历史数据和业务的兼容，⽼系统过度
    - 空中加油：难度最⼤、历史数据兼容复杂、业务分⽀多、发布过程中的灰度要⾮常短，切换速度再快也要防⽌脏数据的产⽣
    - 新旧分割：⽼⽤户⽤⽼系统，新⽤户⽤新系统，数据互相隔离，待新系统完全稳定后可以对⽼系统⽤户做后端迁移，常⽤于APP版本共存阶段
    - 休克疗法：⼀⼑切，制定好停机时间，⽼系统关闭，历史数据迁移，新系统开启使⽤，升级失败会处于两难的境地，多⽤于垄断性APP或强⼤的甲⽅
- 解决当前问题：新需求的和业务功能的扩展
    - 投⼊产出⽐⾼：需求估时中，对系统流程和架构的了解时间⽐例要低于20%
    - ⽇常维护成本低：系统功能性问题不影响业务需求的发展
    - 可扩展性强：避免出现增加⼀个⼩功能就进⾏⼤动⼲⼽的整体回归测试
    - 系统稳定、故障率低：**SLA⾄少在四个9**，服务停机时间不能超过5分钟以上
- 适度解决未来问题：don't over design
    - 充分分析：时间成本、⼈⼒成本、机会成本
    - 未来2-3年⽤户规模的扩⼤程度
    - 未来2-3年现有⽤户的⾃我成⻓和进化⽅向
    - 竞争对⼿商业竞争的残酷性
    - 未来2-3年技术栈的更新迭代
    - 研发团队的⾃身因素（团队稳定、结构、成本）

<!-- more -->
#### 制定架构设计的目标

系统架构不是⽆⽬的性的设计和规划，⼀定是基于业务本身去做设计和分析，系统架构也不是⼀蹴⽽就的，是随着业务的发展逐步优化和⽣⻓起来的，但在前期设计的时候就需要给后期做好预留⼯作，这就需要对系统架构的相关设计理论和原则进⾏掌握和学习，第⼀步先明确架构设计的⽬标。

- ⾼可⽤性：系统整体可⽤性SLA⾄少99.99%，整个系统全年不超过50分钟，单个系统故障不超过5分钟；
    - SLA 99.99% 的计算⽅式 99.99% = 8760 * 0.0001 = 0.876⼩时 = 0.876 * 60 = 52.6分钟
- ⾼可扩展性：架构简单清晰，应⽤系统间耦合低，容易⽔平扩展；
- 低成本：提⾼服务重⽤性，降低⼈⼒成本，减少服务器成本；
- 多快好省：构建平台兼顾效率和性能，以⾼时效低成本为⽬标。

#### 制定架构质量要求

- 单⼀责任原则：这个⼤家在设计模式⾥应该都接触过，⼀个接⼝、⽅法、类，都应该只承担⼀个任务或责任，⽽不是完成多个任务功能，这样复杂度降低后便于功能维护、⻛险控制、变更管理等，⽽对于⼀个系统功能模块或服务也是⼀样，如果功能复杂，系统耦合度很⾼就不便于后续进⾏分布式扩展，功能模块互相影响也会导致业务节点崩溃（eg：业务系统和数据库放在同⼀台设备上就是严重违背单⼀责任的架构⽅式，这也就是俗称单⼀应⽤架构）
- DID原则：Design(D)设计20倍的容量；Implement(I)实施3倍的容量；Deploy（D）部署1.5倍的容量（eg：在未来2-3年时间你设计的系统架构在不进⾏系统化重构的情况下可以通过设备或节点扩展正常⽀撑业务发展）
- N+1原则：任何业务服务节点永远不要少于两个可独⽴运⾏设备（eg：集群服务的前提条件）
- 版本可回退：单线上版本发布后出现问题，可以回退⾄上⼀次正常的业务状态
- 功能可开关：系统的⼀些功能⼊⼝可以进⾏关闭并做出友好提示（eg：X宝双11当天，⽆法查询个⼈历史订单和商品物流信息等）
- 系统容错：⼀个系统总是或多或少出现⼀些未知的系统问题，但对于⽤户则不要将类似404、500、502等错误展示在前端（eg：通过技术⼿段将错误展示⻚⾯转⾄提前准备的友好提示⻚⾯，并能从该⻚⾯继续进⾏业务操作）
- 服务可重用：这是系统服务化的前提
- 服务可水平拓展：⽔平扩展实现服务集群化以及⽔平服务能⼒随时增加，系统要⽔平扩展⾮垂直升级。永远不要依懒更⼤、更快的服务器系统。
- 松耦合、抽象化：开发层⾯的松耦合⼤家都很熟悉了，系统架构层⾯最典型的应⽤就是模块之间的服务调⽤，⽽不是将模块功能内嵌，现在的微服务架构就很好的实现了这个原则
- 不过度设计：杜绝浪费是在任何时候都要考虑到的，开源节流中的节流是系统架构设计中需要着重考虑的，虽然前⾯有DID原则但⼀个系统的技术架构也不要为未来5年甚⾄是10年来买单
- 使⽤成熟的技术：使⽤成熟技术好处有三点 1、不是吃螃蟹的第⼀⼈，没有太多技术坑，有问题也能很快的找到解决⽅案 2、学习资料充⾜，应⽤成本低 3、市场上技术⼈员保有量⾼，⼈好招
- 采⽤同质化硬件或云服务：现在企业很少⾃建IDC机房或进⾏服务器租⽤，基本都上云了，整个系统的云服务采⽤同⼀家服务商，可以避免⽹络消耗，出现问题也好统⼀服务解决，避免跨服务商出现不可知的问题

#### 架构设计组成的关键层级

##### 业务架构的设计⽅法与实现
- 业务架构的设计原则（以电商为例）
    - 业务平台化：业务平台化，相互独立。如交易平台、仓储平台、物流平台、支付平台、广告平台等基础业务下沉，可复用。如用户商品、类目、促销、时效等
    - 核心业务、非核心业务分离：电商核心业务与非核心业务分离核心业务精简(利于稳定)，非核心业务多样化。如，主交易服务、通用交易服务
    - 隔离不同类型的业务：交易业务是签订买家和卖家之间的交易合同，需要优先保证高可用性让用户能快速下单履约业务对可用性没有太高要求可以优先保证一致性闪购业务对高并发要求很高，应该跟普通业务隔离
    - 区分主流程、辅流程：分清哪些是电商的主流程。运行时优先保证主流程的顺利完成，辅流程可以采用后台异步的方式。避免辅流程的失败导致主流程的回滚。如，下单时，同步调用快照，异先通知台账、发票式
- 业务架构的设计实例
![](desgn1.png)
- 应⽤架构设计原则
  - 稳定性原则
  - 解耦/拆分
  - 抽象化
  - 松耦合
  - 容错设计
![](design2.png)


[附件：系统架构思维掌握.pdf](001.pdf)
[附件：系统架构演进&架构师成长规划.pdf](002.pdf)